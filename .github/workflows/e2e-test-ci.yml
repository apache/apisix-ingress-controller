name: e2e-test-ci

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master
      - test/e2e-sanity-case
jobs:
  install-minikube:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - uses: opsgang/ga-setup-minikube@v0.1.1
        with:
          minikube-version: 1.14.2
          k8s-version: 1.19.2
      - name: launching
        run: |
          minikube config set vm-driver docker
          minikube config set kubernetes-version v1.19.2
          minikube start
          minikube update-context
          kubectl cluster-info

  run-test:
    runs-on: ubuntu-latest
    needs: install-minikube
    steps:
      - uses: actions/checkout@v2
      - name: setup go
        uses: actions/setup-go@v1
        with:
          go-version: '1.13'
      - name: run e2e test cases
        working-directory: ./
        run: |
          make e2e-test
